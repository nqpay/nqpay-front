<template>
  <div class="bg-[#1C1C1E] fixed inset-0 flex flex-col px-10">
    <div v-if="isLoading" class="mt-20 flex flex-col gap-4 animate-pulse">
      <div class="h-8 bg-gray-600 rounded w-1/3"></div>
      <div class="h-10"></div>
      <div class="h-12 bg-gray-600 rounded w-full"></div>
      <div class="h-12 bg-gray-600 rounded w-full"></div>
    </div>

    <div v-else class="mt-20 flex flex-col gap-4 flex-1">
      <h1 class="text-white font-semibold text-2xl">Hola {{ name }} </h1>
      <p class="text-white font-regular">Gracias por formar parte de NQ</p>
      <div class="flex flex-col gap-4 mt-10">
        <button v-on:click="showTyC = true" class="bg-[#BE38F3] w-full text-white rounded-lg p-3">T茅rminos y Condiciones</button>
        <button @click="handleSignOut" class="border border-[#BE38F3] w-full text-white rounded-lg p-3">Cerrar Sesi贸n</button>
      </div>
      <div class="flex-1"></div>
    </div>

    <transition
      enter-active-class="transition-all duration-300 ease-out"
      enter-from-class="translate-y-full opacity-0"
      enter-to-class="translate-y-0 opacity-100"
      leave-active-class="transition-all duration-300 ease-in"
      leave-from-class="translate-y-0 opacity-100"
      leave-to-class="translate-y-full opacity-0"
    >
      <div v-show="showTyC" class="absolute bottom-0 left-0 right-0 h-[85%] bg-white rounded-t-3xl flex flex-col pb-20">
        <div class="flex-grow overflow-y-auto p-8 pb-4">
          <h1 class="text-xl font-bold mb-4">T茅rminos y Condiciones</h1>
          <div>
            <p class="font-medium text-lg mb-2">1. Aceptaci贸n de los T茅rminos y Condiciones</p>
            <p>
              Al registrarte o utilizar la plataforma de NQ Pay, acept谩s y acord谩s cumplir con los presentes T茅rminos y Condiciones. En caso de no estar de acuerdo con alguno de
              los siguientes puntos, no podr谩s utilizar el servicio.
            </p>
          </div>

          <!-- Secci贸n 2: Descripci贸n -->
          <div>
            <p class="font-medium text-lg mb-2">2. Descripci贸n del Servicio</p>
            <p>
              NQ Pay es una plataforma que facilita el proceso de pedidos y pagos de bebidas en eventos y fiestas, permitiendo a los usuarios realizar pedidos desde su dispositivo
              m贸vil y retirarlos por la barra o el punto de retiro propuesto por el recinto f铆sico.
            </p>
          </div>

          <!-- Secci贸n 3: Registro -->
          <div>
            <p class="font-medium text-lg mb-2">3. Registro de Usuarios</p>
            <p>
              Para utilizar la aplicaci贸n, debes crear una cuenta con informaci贸n v谩lida y ver铆dica. El registro y uso de la app est谩 destinado 煤nicamente a personas mayores de 18
              a帽os. Al registrarte, confirm谩s que cumpl铆s con la mayor铆a de edad.
            </p>
          </div>

          <!-- Secci贸n 4: Uso -->
          <div>
            <p class="font-medium text-lg mb-2">4. Uso de la Aplicaci贸n</p>
            <p>La aplicaci贸n est谩 dise帽ada para facilitar la compra de bebidas en eventos espec铆ficos y no garantiza disponibilidad de productos ni tiempos exactos de entrega.</p>
          </div>

          <!-- Secci贸n 5: Disponibilidad -->
          <div>
            <p class="font-medium text-lg mb-2">5. Disponibilidad de Productos</p>
            <p>
              NQ Pay no garantiza que todos los productos mostrados en el men煤 estar谩n disponibles en el momento de la compra. El stock de bebidas es administrado por el recinto y
              no por la plataforma.
            </p>
            <p class="mt-2">
              Si el usuario realiza el pedido de un producto que no est谩 disponible, NQ Pay se compromete a realizar el reembolso del importe correspondiente de manera oportuna.
              Por problemas de este estilo, por favor contactarse con ayuda@nqpay.lat
            </p>
          </div>

          <!-- Secci贸n 6: Proceso de Pedido -->
          <div>
            <p class="font-medium text-lg mb-2">6. Proceso de Pedido y Pago</p>
            <p>Para realizar un pedido, el usuario debe:</p>
            <ul class="list-disc pl-6 mt-2 space-y-2">
              <li>
                Seleccionar el producto desde el men煤 disponible en el evento, luego de haber escaneado con la c谩mara de su smartphone el c贸digo QR que se encuentra en el recinto.
              </li>
              <li>Confirmar la cantidad y realizar el pago mediante la plataforma Mercado Pago, el 煤nico m茅todo de pago aceptado en la aplicaci贸n.</li>
            </ul>
          </div>

          <!-- Secci贸n 7: Pagos -->
          <div>
            <p class="font-medium text-lg mb-2">7. Responsabilidad en el Procesamiento de Pagos</p>
            <p>
              Los pagos en NQ Pay se procesan exclusivamente a trav茅s de la plataforma de Mercado Pago. NQ Pay no es responsable por problemas de conexi贸n, errores en el
              procesamiento de pagos, rechazo de transacciones o cualquier otro inconveniente derivado del uso de Mercado Pago.
            </p>
          </div>

          <!-- Secci贸n 8: Retiro -->
          <div>
            <p class="font-medium text-lg mb-2">8. Retiro del Pedido</p>
            <p>
              Una vez confirmado el pedido, la plataforma le arrojar谩 un c贸digo QR al usuario, que deber谩 utilizar para retirar su pedido en la barra o punto de recogida designado
              en el evento. Es responsabilidad del usuario monitorear el estado del pedido y retirarlo antes de que finalice el evento.
            </p>
          </div>

          <!-- Secci贸n 9: Responsabilidad -->
          <div>
            <p class="font-medium text-lg mb-2">9. Responsabilidad del Usuario en el Consumo de Alcohol</p>
            <p>
              El consumo de bebidas alcoh贸licas est谩 estrictamente limitado a usuarios mayores de 18 a帽os. NQ Pay puede solicitar identificaci贸n en cualquier momento. El usuario es
              responsable del consumo de alcohol y sus consecuencias.
            </p>
          </div>

          <!-- Secci贸n 10: Reembolsos -->
          <div>
            <p class="font-medium text-lg mb-2">10. Pol铆tica de Reembolsos y Cancelaciones</p>
            <p>
              No se permiten cancelaciones de pedidos una vez confirmados y pagados, exceptuando los casos de error t茅cnico o falta de stock del producto solicitado, donde se
              proceder谩 a un reembolso total del producto por las v铆as que NQ Pay indique. Por problemas de este estilo, por favor contactarse con ayuda@nqpay.lat
            </p>
          </div>

          <!-- Secci贸n 11: Datos -->
          <div>
            <p class="font-medium text-lg mb-2">11. Uso de Datos Personales</p>
            <p>
              NQ Pay recopila y utiliza informaci贸n personal del usuario conforme a nuestra Pol铆tica de Privacidad. Al utilizar la plataforma, consent铆s que NQ Pay utilice tus
              datos conforme a esta pol铆tica.
            </p>
          </div>

          <!-- Secci贸n 12: Modificaciones -->
          <div>
            <p class="font-medium text-lg mb-2">12. Modificaci贸n de los T茅rminos y Condiciones</p>
            <p>
              NQ Pay se reserva el derecho de actualizar estos T茅rminos y Condiciones en cualquier momento. Cualquier cambio ser谩 notificado a los usuarios mediante la plataforma.
            </p>
          </div>

          <!-- Secci贸n 13: Jurisdicci贸n -->
          <div>
            <p class="font-medium text-lg mb-2">13. Jurisdicci贸n y Ley Aplicable</p>
            <p>Estos T茅rminos y Condiciones se regir谩n por las leyes vigentes en la jurisdicci贸n donde se encuentre el usuario o donde se realice el evento.</p>
          </div>

          <!-- Secci贸n 14: Contacto -->
          <div>
            <p class="font-medium text-lg mb-2">14. Contacto</p>
            <p>Para consultas o comentarios sobre los T茅rminos y Condiciones, pod茅s contactarnos a trav茅s del correo electr贸nico: ayuda@nqpay.lat</p>
          </div>
        </div>
        <div v-on:click="showTyC = false" class="left-8 right-8 bg-[#BE38F3] py-3 text-white font-semibold text-xl text-center rounded-xl">Volver</div>
      </div>
    </transition>

    <NavBar v-if="!isLoading" currentView="Profile" class="fixed bottom-0 left-0 right-0" />
  </div>

  <Suspense>
    <template #fallback>
      <h1>Loading</h1>
    </template>
  </Suspense>
</template>

<script setup>
import { useRouter } from 'vue-router'
import { onMounted, ref } from 'vue'
import { getAuth, signOut, onAuthStateChanged } from 'firebase/auth'
import NavBar from './NavBar.vue'

const showTyC = ref(false)
const router = useRouter()
const isLoggedIn = ref(false)
const isLoading = ref(true)
const name = ref(localStorage.getItem('name'))
let auth

const fetchUserName = async () => {
  try {
    const idToken = await auth.currentUser.getIdToken()
    const response = await fetch(`https://api.nqpay.lat/me`, {
      method: 'GET',
      headers: {
        Authorization: `Bearer ${idToken}`,
      },
    })
    const data = await response.json()
    localStorage.setItem('name', data.Name)
    name.value = data.Name
  } catch (error) {
    console.log('Error fetching user name:', error.message)
  } finally {
    isLoading.value = false
  }
}

onMounted(() => {
  auth = getAuth()
  onAuthStateChanged(auth, (user) => {
    if (user) {
      console.log('User is logged in')
      isLoggedIn.value = true
      if (!name.value) {
        fetchUserName()
      } else {
        isLoading.value = false
      }
    } else {
      console.log('User is logged out')
      isLoggedIn.value = false
      isLoading.value = false
    }
  })
})

const handleSignOut = () => {
  signOut(auth)
    .then(() => {
      console.log('Sign Out')
      router.push('/')
      localStorage.clear()
    })
    .catch((error) => {
      console.log(error.message)
    })
}
</script>
